{"version":3,"file":"DiscountedItems-7047c0db.js","sources":["../../src/pages/discount/Discounted/DiscountedItems.tsx"],"sourcesContent":["import { useState, useRef, useEffect } from \"react\";\r\nimport { AiOutlineFire, AiOutlineCaretRight } from \"react-icons/ai\";\r\nimport { useFetchDiscountedProductsQuery } from \"@/shared/api/userApi\";\r\nimport Loading from \"@/shared/ui/Loading/Loading\";\r\nimport Text from \"@/shared/ui/Text/Text\";\r\nimport { NavLink } from \"react-router-dom\";\r\n\r\nconst DiscountedItems = () => {\r\n  const { data: products, isLoading, error } = useFetchDiscountedProductsQuery(null);\r\n  const scrollContainerRef = useRef(null);\r\n  const [scrollProgress, setScrollProgress] = useState(0);\r\n  const [isDraggingTrack, setIsDraggingTrack] = useState(false);\r\n\r\n\r\n\r\n  // --- Логика Скролла и Прогресс-бара ---\r\n\r\n  // Функция, которая вычисляет процент прокрутки при скролле контейнера\r\n  const handleScroll = () => {\r\n    const el = scrollContainerRef.current;\r\n    if (!el) return;\r\n    // Вычисляем, сколько пикселей можно проскроллить всего (общая ширина минус видимая ширина)\r\n    const maxScrollLeft = el.scrollWidth - el.clientWidth;\r\n    // Вычисляем текущий процент (текущая позиция / макс. позиция)\r\n    const progress = (el.scrollLeft / maxScrollLeft) * 100;\r\n    setScrollProgress(progress);\r\n  };\r\n\r\n  // Функция для клика/перетаскивания по прогресс-бару\r\n  const handleTrackClickOrDrag = (e) => {\r\n    const track = e.currentTarget.getBoundingClientRect();\r\n    const clickX = e.clientX - track.left; // Позиция клика внутри трека\r\n    const percentage = clickX / track.width; // Процент от ширины трека\r\n\r\n    const el = scrollContainerRef.current;\r\n    if (!el) return;\r\n    const maxScrollLeft = el.scrollWidth - el.clientWidth;\r\n    // Прокручиваем контейнер к вычисленной позиции\r\n    el.scrollTo({\r\n      left: maxScrollLeft * percentage,\r\n      behavior: 'smooth' // Плавная прокрутка\r\n    });\r\n  };\r\n\r\n  // Обработчики для перетаскивания (Drag) ползунка\r\n  const handleMouseDown = (e) => {\r\n    setIsDraggingTrack(true);\r\n    handleTrackClickOrDrag(e); // Сразу прыгаем в место клика\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleMouseMove = (e) => {\r\n      if (!isDraggingTrack) return;\r\n      // Если мы в режиме перетаскивания, находим элемент трека и вызываем функцию скролла\r\n      const trackElement = document.getElementById('custom-scroll-track');\r\n      if (trackElement) {\r\n        // Эмулируем событие с нужными координатами на основе движения мыши по окну\r\n        const rect = trackElement.getBoundingClientRect();\r\n        // Ограничиваем координаты внутри трека\r\n        let clientX = e.clientX;\r\n        if (clientX < rect.left) clientX = rect.left;\r\n        if (clientX > rect.right) clientX = rect.right;\r\n\r\n        handleTrackClickOrDrag({\r\n          currentTarget: trackElement,\r\n          clientX: clientX\r\n        });\r\n      }\r\n    };\r\n\r\n    const handleMouseUp = () => {\r\n      setIsDraggingTrack(false);\r\n    };\r\n\r\n    if (isDraggingTrack) {\r\n      window.addEventListener('mousemove', handleMouseMove);\r\n      window.addEventListener('mouseup', handleMouseUp);\r\n    }\r\n\r\n    return () => {\r\n      window.removeEventListener('mousemove', handleMouseMove);\r\n      window.removeEventListener('mouseup', handleMouseUp);\r\n    };\r\n  }, [isDraggingTrack]);\r\n\r\n\r\n  // Форматтер цены\r\n  const formatPrice = (price) => {\r\n    return new Intl.NumberFormat('ru-RU').format(Math.round(price));\r\n  };\r\n  if (isLoading || !products) {\r\n    if (error) console.error(error);\r\n    return <Loading />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full py-12 px-4 bg-gray-50 py-20 overflow-hidden\">\r\n\r\n      {/* Заголовок */}\r\n      <div className=\"max-w-7xl mx-auto mb-8 flex items-center gap-3 px-4 md:px-0\">\r\n        <div className=\"p-2.5 bg-rose-100 rounded-2xl text-rose-600 shadow-sm\">\r\n          <AiOutlineFire size={26} />\r\n        </div>\r\n        <div>\r\n          <Text text=\"Горячие скидки\" className=\"text-2xl md:text-3xl font-bold text-gray-800 leading-tight\" />\r\n          <p className=\"text-gray-500 text-sm mt-1\">Успейте купить по лучшей цене</p>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"relative w-full max-w-[1400px] mx-auto\">\r\n\r\n        {/*\r\n            ОСНОВНОЙ КОНТЕЙНЕР СКРОЛЛА\r\n            - flex row: выстраивает элементы в ряд\r\n            - overflow-x-auto: включает горизонтальный скролл\r\n            - scrollbar-hide: (нужен плагин tailwind-scrollbar-hide или кастомный CSS) скрывает стандартный скроллбар\r\n            - scroll-smooth: делает прокрутку плавной\r\n            - snap-x: добавляет \"прилипание\" к карточкам (опционально, можно убрать для полной плавности)\r\n        */}\r\n        <div\r\n          ref={scrollContainerRef}\r\n          onScroll={handleScroll}\r\n          className=\"flex gap-4 md:gap-6 overflow-x-auto pb-8 pt-4 px-4 md:px-8\r\n                     scrollbar-hide scroll-smooth snap-x snap-mandatory touch-pan-x\"\r\n          style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }} // Fallback CSS для скрытия скроллбара\r\n        >\r\n          {/* Добавляем пустой паддинг в начале, чтобы первая карточка не прилипала к краю экрана на широких мониторах */}\r\n          <div className=\"shrink-0 w-0 md:w-4 lg:w-8\" />\r\n\r\n          {products.map((item) => {\r\n            const newPrice = item.price * (1 - item.discount / 100);\r\n            return (\r\n              <NavLink\r\n                to={`/data/${item._id}`}\r\n                key={item._id}\r\n                // shrink-0 w-[280px] md:w-[320px] - фиксируем ширину карточки, чтобы они не сжимались\r\n                // snap-start - указывает место, к которому прилипает скролл\r\n                className=\"group relative flex flex-col shrink-0 w-[260px] sm:w-[280px] md:w-[320px] snap-start\r\n                               bg-white rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-1\r\n                               transition-all duration-500 ease-out overflow-hidden border border-gray-100/50\"\r\n              >\r\n                {/* ИЗОБРАЖЕНИЕ */}\r\n                <div className=\"relative w-full aspect-[4/3] overflow-hidden bg-gray-100\">\r\n                  <img\r\n                    src={item.imageURL[0]}\r\n                    alt={item.name}\r\n                    className=\"w-full h-full object-cover mix-blend-multiply group-hover:scale-105 transition-transform duration-700 ease-in-out\"\r\n                  />\r\n                  {item.discount > 0 && (\r\n                    <div className=\"absolute top-3 left-3 bg-white/90 backdrop-blur-sm text-rose-600 text-sm font-extrabold px-3 py-1.5 rounded-full shadow-sm z-10 flex items-center gap-1\">\r\n                      <AiOutlineFire size={14} />\r\n                      -{item.discount}%\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* ИНФОРМАЦИЯ */}\r\n                <div className=\"p-5 flex flex-col flex-grow bg-gradient-to-b from-white to-gray-50/30\">\r\n                  <h3 className=\"text-gray-800 font-semibold text-base leading-snug mb-3 line-clamp-2 group-hover:text-rose-600 transition-colors\">\r\n                    {item.name}\r\n                  </h3>\r\n\r\n                  <div className=\"mt-auto flex items-end justify-between\">\r\n                    <div className=\"flex flex-col\">\r\n                      <span className=\"text-sm text-gray-400 line-through mb-0.5\">\r\n                        {formatPrice(item.price)} ₽\r\n                      </span>\r\n                      <span className=\"text-2xl font-black text-gray-900 tracking-tight flex gap-1 items-baseline\">\r\n                        {formatPrice(newPrice)} <span className=\"text-sm font-medium text-gray-500\">₽</span>\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"w-10 h-10 rounded-full bg-rose-50 text-rose-500 flex items-center justify-center group-hover:bg-rose-500 group-hover:text-white transition-all duration-300 scale-90 group-hover:scale-100 shadow-sm\">\r\n                      <AiOutlineCaretRight size={18} />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </NavLink>\r\n            )\r\n          })}\r\n          {/* Паддинг в конце */}\r\n          <div className=\"shrink-0 w-4 md:w-8 lg:w-12\" />\r\n        </div>\r\n\r\n        {/* --- ОРИГИНАЛЬНОЕ РЕШЕНИЕ: ИНТЕРАКТИВНЫЙ ПРОГРЕСС-БАР --- */}\r\n        <div className=\"max-w-md mx-auto mt-2 px-4 flex items-center justify-center\">\r\n          <div\r\n            id=\"custom-scroll-track\"\r\n            onMouseDown={handleMouseDown}\r\n            // onClick={handleTrackClickOrDrag} // onClick можно убрать, так как onMouseDown + логика драга покрывает и клик\r\n            className={`relative w-full h-1.5 bg-gray-200 rounded-full overflow-hidden cursor-pointer transition-all duration-300 ${isDraggingTrack ? 'h-2.5' : 'hover:h-2.5'}`}\r\n          >\r\n            {/* Заполнитель (Ползунок) */}\r\n            <div\r\n              className={`absolute top-0 left-0 h-full bg-rose-500 rounded-full transition-all duration-150 ease-out ${isDraggingTrack ? 'bg-rose-600' : ''}`}\r\n              style={{ width: `${scrollProgress}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DiscountedItems;"],"names":["DiscountedItems","data","products","isLoading","error","useFetchDiscountedProductsQuery","scrollContainerRef","useRef","scrollProgress","setScrollProgress","useState","isDraggingTrack","setIsDraggingTrack","handleTrackClickOrDrag","e","track","currentTarget","getBoundingClientRect","percentage","clientX","left","width","el","current","maxScrollLeft","scrollWidth","clientWidth","scrollTo","behavior","useEffect","handleMouseMove","trackElement","document","getElementById","rect","right","handleMouseUp","window","addEventListener","removeEventListener","formatPrice","price","Intl","NumberFormat","format","Math","round","console","Loading","jsxs","className","children","jsx","AiOutlineFire","size","Text","text","jsxRuntimeExports","ref","onScroll","progress","scrollLeft","style","scrollbarWidth","msOverflowStyle","map","item","newPrice","discount","NavLink","to","_id","src","imageURL","alt","name","AiOutlineCaretRight","id","onMouseDown"],"mappings":"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"}